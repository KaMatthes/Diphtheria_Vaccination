---
title: "Diphteria Vaccination"
author: "Katarina Matthes"
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
    code_folding: show
    self_contained: true
    highlight: pygments
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Switzerland

## Incidence monthly
```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_inc_total()
```

## Trend monthly

```{r, echo=FALSE,message=FALSE,fig.height = 20,  fig.width = 35}
function_seasonal_trend()
```

only data until 1949

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_month_trend()
```

## Incidence annualy
```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_inc_total_year()
```

## Mortality
```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_mort_total()
```

## Case fatality rate
```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_fatality_total()
```

## Hospitalisation
```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_hosp_total()
```


#  Forecast cases

* Annually data
* Bayesian framework
* zero inflated negative binomial distribution (in smaller cantons many zeros)
* autocorralation added as 1-order term (ar1)
* seasonal effect


## All cantons

Predicted from 1943

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_cases_canton_year(Kt="Total")
```

```{r ,echo=FALSE,message=FALSE}
 function_5_year("Total") %>%
  kbl() %>%
  kable_classic_2(full_width = F)
```

## Cantons with vaccination recommendations

Predicted from 1945

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_cases_vacc_year(Type_vacc = "Recommendation")
```

```{r ,echo=FALSE,message=FALSE}
 function_5_year_vacc(Type_vacc="Recommendation") %>%
  kbl() %>%
  kable_classic_2(full_width = F)
```

## Cantons with compulsory vaccination

Predicted from 1945

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_cases_vacc_year(Type_vacc = "Obligatory")
```

```{r ,echo=FALSE,message=FALSE}
 function_5_year_vacc(Type_vacc="Obligatory") %>%
  kbl() %>%
  kable_classic_2(full_width = F)
```

### Individual cantons with compulsory vaccination
GE = 1933
<br />
VD = 1945
<br />
TI = 1945
<br />
NE = 1945
<br />
FR = 1948


```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_cases_canton_year_obl(Kt="GE")
```

```{r ,echo=FALSE,message=FALSE}
 function_5_year("GE") %>%
  select(-`Case fatality rate (95% CI)`) %>%
  kbl() %>%
  kable_classic_2(full_width = F)
```

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_cases_canton_year_obl(Kt="VD")
```

```{r ,echo=FALSE,message=FALSE}
 function_5_year("VD") %>%
  select(-`Case fatality rate (95% CI)`) %>%
  kbl() %>%
  kable_classic_2(full_width = F)
```

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_cases_canton_year_obl(Kt="TI")
```

```{r ,echo=FALSE,message=FALSE}
 function_5_year("TI") %>%
  select(-`Case fatality rate (95% CI)`) %>%
  kbl() %>%
  kable_classic_2(full_width = F)
```

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_cases_canton_year_obl(Kt="NE")
```

```{r ,echo=FALSE,message=FALSE}
 function_5_year("NE") %>%
  select(-`Case fatality rate (95% CI)`) %>%
  kbl() %>%
  kable_classic_2(full_width = F)
```


```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_cases_canton_year_obl(Kt="FR")
```

```{r ,echo=FALSE,message=FALSE}
 function_5_year("FR") %>%
  select(-`Case fatality rate (95% CI)`) %>%
  kbl() %>%
  kable_classic_2(full_width = F)
```

## Annually 1933
Prediction from 1934 (to compare with Geneva). Total without Geneva
<br />


```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_cases_canton_year(Kt="Total_GE")
```

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_cases_canton_year(Kt="GE_2")
```


# Forecast death

Predicted

* Annual data
* Bayesian framework
* Zero inflated negative binomial distribution (in smaller cantons many zeros)
* Autocorralation added as 1-order term (ar1)
* seasonal effect (annually effect)


## All cantons

Predicted from 1943

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_death_canton(Kt="Total")
```

## Cantons with vaccination recommendations

Predicted from 1945

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_death_vacc_year(Type_vacc = "Recommendation")
```

## Cantons with compulsory vaccination

Predicted from 1945

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_death_vacc_year(Type_vacc = "Obligatory")
```

### Individual cantons with compulsory vaccination
GE = 1933
<br />
VD = 1945
<br />
TI = 1945
<br />
NE = 1945
<br />
FR = 1948


```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_death_canton_year_obl(Kt="GE")
```

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_death_canton_year_obl(Kt="VD")
```

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_death_canton_year_obl(Kt="TI")
```

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_death_canton_year_obl(Kt="NE")
```

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_death_canton_year_obl(Kt="FR")
```

## Annually 1933
Prediction from 1934 (to compare with Geneva). Total without Geneva


```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_death_canton(Kt="Total_GE")
```

```{r, echo=FALSE,message=FALSE,fig.height = 15,  fig.width = 35}
function_figure_death_canton(Kt="GE_2")
```



# Time series from 1940 - 1951

```{r, echo=FALSE,message=FALSE,fig.height = 20,  fig.width = 35}
function_figure_inc_canton_1952(Start_year=1940, End_year=1952)
```

```{r, echo=FALSE,message=FALSE,fig.height = 20,  fig.width = 35}
function_figure_inc_canton_1952_year(Start_year=1940, End_year=1952)
```


```{r, echo=FALSE,message=FALSE,fig.height = 20,  fig.width = 35}
function_figure_mortality_1952(Start_year=1940, End_year=1952)
```


# Time series from 1952 - 1968

```{r, echo=FALSE,message=FALSE,fig.height = 20,  fig.width = 35}
function_figure_inc_canton_1952(Start_year=1952, End_year=1969)
```

```{r, echo=FALSE,message=FALSE,fig.height = 20,  fig.width = 35}
function_figure_inc_canton_1952_year(Start_year=1952, End_year=1969)
```


```{r, echo=FALSE,message=FALSE,fig.height = 20,  fig.width = 35}
function_figure_mortality_1952(Start_year=1952, End_year=1969)
```


# Maps

* In 10 Jahresschritten 
* Inzidenz ist jeweils für die 10 Jahre berechnet
* 1 = Januar - März
* 2 = April - Juni
* 3 = Juli - September
* 4 = Oktober - Dezember


## 1914 - 1923

```{r echo=FALSE, out.width = '100%'}
knitr::include_graphics("../output/Figure_Maps_1914_1923.png")
```

## 1927 - 1936

```{r echo=FALSE, out.width = '100%'}
knitr::include_graphics("../output/Figure_Maps_1927_1936.png")
```

## 1941 - 1950

```{r echo=FALSE, out.width = '100%'}
knitr::include_graphics("../output/Figure_Maps_1941_1950.png")
```


